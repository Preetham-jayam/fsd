<%-include("../partials/adminheader.ejs");%>
<% if (messages.success) { %>
  <div class="alert alert-success"><%= messages.success %></div>
<% } %>

<% if (messages.error) { %>
  <div class="alert alert-danger"><%= messages.error %></div>
<% } %>
<h1 class="display-3 text-center" style="font-size: 3rem;">Student Details</h1>
<div style="text-align: center; margin: 10px; margin-bottom:20px ;" >
<a href="/admin/mail" class="btn btn-success">Make Announcements to Students</a>
</div>

       
      
      
<div class="container">
  <% var i = 0; %>
  <% users.forEach((user) => { %>
    <% if (user.student) { %>
      <% if (i % 3 === 0) { %>
        <div class="row">
      <% } %>
      
      <div class="col-md-4" id="user-card-<%= user._id %>">
        <div class="card h-100 shadow mb-3">
          <img class="card-img-top img-thumbnail" src="https://img.freepik.com/premium-vector/happy-smiling-young-man-avatar-3d-portrait-man-cartoon-character-people-vector-illustration_653240-187.jpg?w=740" style="height: 250px;" alt="Can not display">
          <div class="card-body d-flex flex-column">
            <h3 class="card-title"><%= user.student.firstName %></h3>
            <ul class="list-unstyled">
              <li><b>Firstname:</b> <%= user.student.firstName %></li>
              <li><b>Lastname:</b> <%= user.student.lastName %></li>
              <li><b>PhoneNo:</b> <%= user.student.phoneNo %></li>
              <li><b>Address:</b> <%= user.student.address %></li>
              <li><b>Type:</b> <span>Student</span></li>
              <li><b>Courses:</b></li>
              <ul>
                <% user.student.courses.forEach((course) => { %>
                  <li><%= course.title %></li>
                <% }) %>
              </ul>
            </ul>
            <div class="mt-auto">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <% if (user.flag === 0) { %>
                    <a href="/admin/block/<%= user._id %>"> 
                      <button id="block-btn" type="submit" class="btn btn-outline-danger">Block</button>
                    </a>
                  <% } else { %>
                    <a href="/admin/block/<%= user._id %>"> 
                      <button id="block-btn" type="submit" class="btn btn-outline-success">UnBlock</button>
                    </a>
                  <% } %>
                </div>
                <div>
                  <!-- <a href="/admin/delete/<%= user._id %>">
                    <button type="button" class="btn btn-danger">Delete</button>
                  </a> -->
                  <button type="button" class="delete-user-btn btn btn-danger" data-user-id="<%=user._id%>">Delete</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <% i++; %>
      <% if (i % 3 === 0) { %>
        </div>
      <% } %>
    <% } %>
  <% }) %>   

  <% if (i % 3 !== 0) { %>
    </div>
  <% } %>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  document.addEventListener("click", function (event) {
    const target = event.target;

    if (target.classList.contains("delete-user-btn")) {
      const userId = target.getAttribute("data-user-id");
      console.log(userId);

      const xhr = new XMLHttpRequest();
      xhr.open("POST", `/admin/delete/${userId}`, true);

      xhr.onload = function () {
        if (xhr.status === 200) {
          const response = JSON.parse(xhr.responseText);
          if (response.success === true) {
            const userCard = document.getElementById(`user-card-${userId}`);
            if (userCard) {
              userCard.remove();
            }
            alert(response.msg);
          }
          console.log(response);
        } else {
          console.error("Request failed with status:", xhr.status);
        }
      };

      xhr.onerror = function () {
        console.error("Request failed");
      };

      xhr.send();
    }
  });
</script>

           
        
<%-include('../partials/adminfooter.ejs');%>

